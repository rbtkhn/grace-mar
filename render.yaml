# Render Blueprint: Grace-Mar Mini App + Telegram Webhook
# See docs/miniapp-setup.md and docs/telegram-webhook-setup.md.
#
# Telegram bot runs via webhook on the miniapp service (no separate worker).
# RENDER_EXTERNAL_URL is set automatically; webhook URL = RENDER_EXTERNAL_URL/telegram/webhook

services:
  - type: web
    name: grace-mar-miniapp
    runtime: python
    buildCommand: pip install -r requirements.txt
    startCommand: python miniapp_server.py
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: GITHUB_TOKEN
        sync: false
      - key: GRACE_MAR_REPO
        value: rbtkhn/grace-mar
      - key: TELEGRAM_BOT_TOKEN
        sync: false  # When set, Telegram webhook is enabled (RENDER_EXTERNAL_URL used)
      - key: PROFILE_MINIAPP_URL
        sync: false  # URL for bot menu button (e.g. https://grace-mar.com for profile); DASHBOARD_MINIAPP_URL still supported
      - key: OPERATOR_FETCH_SECRET
        sync: false  # Optional: when set, GET /operator/session-transcript and /operator/pending-review return live files (Bearer token). Use scripts/fetch_operator_files.py from Cursor to pull chat into local repo.
